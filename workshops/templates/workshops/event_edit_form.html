{% extends "workshops/_page.html" %}

{% load crispy_forms_tags %}
{% load selectable_tags %}

{% block content %}
  <button type="button" class="btn btn-default" id="update_url_button">Update from URL</button>
  {% crispy event_form %}

  <!-- Event update from URL modal -->
  <div class="modal fade" id="update_url_modal" tabindex="-1" role="dialog" aria-labelledby="update_url_modal_label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
          <h4 class="modal-title" id="update_url_modal_label">Update event data from URL</h4>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger hidden" id="error_message"></div>
          <form id="update_url_form">
            {% csrf_token %}
            <div class="form-group">
              <label for="event_update_url" class="control-label">Event URL:</label>
              <input type="url" id="event_update_url" name="url" required="required" class="form-control" value="{{ object.url }}" />
              <p class="help-block">Use URL to the event's website, for example <code>http://swcarpentry.github.io/workshop-template/</code>.</p>
            </div>
            <div class="form-group">
              <div class="radio">
                <label>
                  <input type="radio" name="event_update_action" value="skip" checked="checked" />
                  Skip non-empty fields.
                </label>
              </div>
              <div class="radio">
                <label>
                  <input type="radio" name="event_update_action" value="overwrite" />
                  Overwrite existing values.
                </label>
              </div>
            </div>
            <button type="submit" class="btn btn-primary" data-loading-text="Loading..." autocomplete="off">Update</button>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <h2 id="associated-tasks">Associated tasks</h2>
  {% crispy task_form form_helper_with_add %}
  {% if tasks %}
  <table class="table table-striped">
  <tr>
    <th>person</th>
    <th>role</th>
    <th>actions</th>
  </tr>
  {% for t in tasks %}
  <tr>
    <td><a href="{{ t.person.get_absolute_url }}">{{ t.person.get_full_name }}</a>{% if t.person.email and t.person.may_contact %} &lt;{{ t.person.email|urlize }}&gt;{% endif %}</td>
    <td>{{ t.role.name }}</td>
    <td><a onclick='return confirm("Are you sure you wish to remove \"{{ t.person.get_full_name }}\" from {{ object.get_ident }}?")' href="{% url 'task_delete' object.get_ident t.id %}" class='btn btn-danger'>Delete</a></td>
  </tr>
  {% endfor %}
  </table>
  {% else %}
  <p>No tasks.</p>
  {% endif %}

{% endblock %}

{% block extrajs %}
{{event_form.media}}
{{task_form.media}}
{% endblock extrajs %}
